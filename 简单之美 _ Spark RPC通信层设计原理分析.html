<!DOCTYPE html>
<!-- saved from url=(0038)http://shiyanjun.cn/archives/1536.html -->
<html lang="zh-CN" class=" js flexbox canvas canvastext postmessage websqldatabase indexeddb hashchange history draganddrop websockets rgba hsla multiplebgs backgroundsize borderimage borderradius boxshadow textshadow opacity cssanimations csscolumns cssgradients cssreflections csstransforms csstransforms3d csstransitions fontface generatedcontent video audio localstorage sessionstorage webworkers applicationcache"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<meta name="baidu_union_verify" content="fa039528e51a3ffc6565fb61e9efe996">
<meta name="baidu-tc-verification" content="50ab2a647c7650cd0f17b1a9de12d89d">
<meta name="viewport" content="width=device-width">
<title>简单之美 | Spark RPC通信层设计原理分析</title>
<link rel="profile" href="http://gmpg.org/xfn/11">
<link rel="pingback" href="http://shiyanjun.cn/xmlrpc.php">


<link rel="alternate" type="application/rss+xml" title="简单之美 » Feed" href="http://shiyanjun.cn/feed">
<link rel="alternate" type="application/rss+xml" title="简单之美 » 评论Feed" href="http://shiyanjun.cn/comments/feed">
<link rel="alternate" type="application/rss+xml" title="简单之美 » Spark RPC通信层设计原理分析评论Feed" href="http://shiyanjun.cn/archives/1536.html/feed">
<link rel="stylesheet" id="mediamaven_style-css" href="./简单之美 _ Spark RPC通信层设计原理分析_files/style.css" type="text/css" media="all">
<link rel="stylesheet" id="wp-pagenavi-css" href="./简单之美 _ Spark RPC通信层设计原理分析_files/pagenavi-css.css" type="text/css" media="all">
<script type="text/javascript" src="./简单之美 _ Spark RPC通信层设计原理分析_files/modernizr-2.6.1.min.js.下载"></script>
<script type="text/javascript" src="./简单之美 _ Spark RPC通信层设计原理分析_files/jquery.js.下载"></script>
<script type="text/javascript" src="./简单之美 _ Spark RPC通信层设计原理分析_files/jquery-migrate.min.js.下载"></script>
<script type="text/javascript" src="./简单之美 _ Spark RPC通信层设计原理分析_files/scripts.js.下载"></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://shiyanjun.cn/xmlrpc.php?rsd">
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://shiyanjun.cn/wp-includes/wlwmanifest.xml"> 
<link rel="prev" title="Apache Flink：特性、概念、组件栈、架构及原理分析" href="http://shiyanjun.cn/archives/1508.html">
<link rel="next" title="Spark Standalone架构设计要点分析" href="http://shiyanjun.cn/archives/1545.html">
<meta name="generator" content="WordPress 3.9.2">
<link rel="canonical" href="http://shiyanjun.cn/archives/1536.html">
<link rel="shortlink" href="http://shiyanjun.cn/?p=1536">
<style type="text/css" id="custom-background-css">
body.custom-background { background-image: url('http://shiyanjun.cn/wp-content/themes/media-maven/library/images/bg.jpg'); background-repeat: repeat; background-position: top left; background-attachment: fixed; }
</style>
<link rel="stylesheet" type="text/css" href="./简单之美 _ Spark RPC通信层设计原理分析_files/shCore.css"><link rel="stylesheet" type="text/css" href="./简单之美 _ Spark RPC通信层设计原理分析_files/shThemeDefault.css"><style type="text/css" id="syntaxhighlighteranchor"></style>
</head>

<body class="single single-post postid-1536 single-format-standard custom-background single-author">
<div id="container">
	<header id="branding" role="banner">
      <div id="inner-header" class="clearfix">
		<hgroup id="site-heading">
			<h1 id="site-title"><a href="http://shiyanjun.cn/" title="简单之美" rel="home">简单之美</a></h1>
			<h2 id="site-description">简单之美，难得简单，享受简单的唯美。</h2>
		</hgroup>

		<nav id="access" role="navigation">
			<h1 class="assistive-text section-heading">Main menu</h1>
			<div class="skip-link screen-reader-text"><a href="http://shiyanjun.cn/archives/1536.html#content" title="Skip to content">Skip to content</a></div>
			<div class="menu"><div id="menu-icon">Menu</div><ul id="menu-%e6%88%91%e7%9a%84%e8%8f%9c%e5%8d%95" class="menu"><li id="menu-item-167" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-167"><a href="http://shiyanjun.cn/">首页</a></li>
<li id="menu-item-118" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-118"><a href="http://shiyanjun.cn/archives/category/programming">编程语言</a></li>
<li id="menu-item-113" class="menu-item menu-item-type-taxonomy menu-item-object-category current-post-ancestor current-menu-parent current-post-parent menu-item-113"><a href="http://shiyanjun.cn/archives/category/opensource">开源技术</a></li>
<li id="menu-item-1607" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-1607"><a href="http://shiyanjun.cn/archives/category/container">容器技术</a></li>
<li id="menu-item-226" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-226"><a href="http://shiyanjun.cn/archives/category/machinelearning">机器学习</a></li>
<li id="menu-item-788" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-788"><a href="http://shiyanjun.cn/archives/category/algorithm">算法</a></li>
<li id="menu-item-126" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-126"><a href="http://shiyanjun.cn/archives/category/database">数据库</a></li>
<li id="menu-item-121" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-121"><a href="http://shiyanjun.cn/archives/category/server">服务器</a></li>
<li id="menu-item-199" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-199"><a href="http://shiyanjun.cn/about">关于</a></li>
</ul></div>			<form role="search" method="get" id="searchform" class="searchform" action="http://shiyanjun.cn/">
				<div>
					<label class="screen-reader-text" for="s">搜索：</label>
					<input type="text" value="" name="s" id="s">
					<input type="submit" id="searchsubmit" value="搜索">
				</div>
			</form>		</nav><!-- #access -->
        

      </div>


	</header><!-- #branding -->

    <div id="content" class="clearfix">
        
        <div id="main" class="col620 clearfix" role="main">

			
				<article id="post-1536" class="post-1536 post type-post status-publish format-standard hentry category-spark category-opensource tag-spark tag-spark-2-0-0">
	<header class="entry-header">
		<h1 class="entry-title">Spark RPC通信层设计原理分析</h1>

		<div class="entry-meta">
			<span class="sep"><i title="发表时间" class="icon-calendar"></i></span> <a href="http://shiyanjun.cn/archives/1536.html" title="22:49:58" rel="bookmark"><time class="entry-date" datetime="2016-09-17T22:49:58+00:00">2016-09-17 22:49:58</time></a> <span class="byline"> <span class="sep"> &nbsp;&nbsp;<i title="文章作者" class="icon-user"></i></span> <span class="author vcard"><a class="url fn n" href="http://shiyanjun.cn/archives/author/yanjun" title="查看作者 Yanjun 的全部文章" rel="author">Yanjun</a></span></span>		</div><!-- .entry-meta -->
	</header><!-- .entry-header -->

	<div class="entry-content post_content">
		<p>Spark将RPC通信层设计的非常巧妙，融合了各种设计/架构模式，将一个分布式集群系统的通信层细节完全屏蔽，这样在上层的计算框架的设计中能够获得很好的灵活性。同时，如果上层想要增加各种新的特性，或者对来自不同企业或组织的程序员贡献的特性，也能够很容易地增加进来，可以避开复杂的通信层而将注意力集中在上层计算框架的处理和优化上，入手难度非常小。另外，对上层计算框架中的各个核心组件的开发、功能增强，以及Bug修复等都会变得更加容易。</p>
<p><strong style="font-size: 20px">Spark RPC层设计概览</strong></p>
<p>Spark RPC层是基于优秀的网络通信框架Netty设计开发的，同时获得了Netty所具有的网络通信的可靠性和高效性。我们先把Spark中与RPC相关的一些类的关系梳理一下，为了能够更直观地表达RPC的设计，我们先从类的设计来看，如下图所示：<br>
<a href="./简单之美 _ Spark RPC通信层设计原理分析_files/SparkRPC-ClassDiagram.png"><img src="./简单之美 _ Spark RPC通信层设计原理分析_files/SparkRPC-ClassDiagram.png" alt="SparkRPC-ClassDiagram" width="1024" height="642" class="alignnone size-full wp-image-1537"></a><br>
通过上图，可以清晰地将RPC设计分离出来，能够对RPC层有一个整体的印象。了解Spark RPC层的几个核心的概念（我们通过Spark源码中对应的类名来标识），能够更好地理解设计：</p>
<ul>
<li>RpcEndpoint</li>
</ul>
<p>RpcEndpoint定义了RPC通信过程中的通信端对象，除了具有管理一个RpcEndpoint生命周期的操作（constructor -&gt; onStart -&gt; receive* -&gt; onStop），并给出了通信过程中一个RpcEndpoint所具有的基于事件驱动的行为（连接、断开、网络异常），实际上对于Spark框架来说主要是接收消息并处理，具体可以看对应特质RpcEndpoint的代码定义，如下所示：</p>
<div id="highlighter_318594" class="syntaxhighlighter  "><div class="bar               "><div class="toolbar"><a href="http://shiyanjun.cn/archives/1536.html#viewSource" title="查看源代码" class="item viewSource" style="width: 16px; height: 16px;">查看源代码</a><div class="item copyToClipboard"><embed width="16" height="16" id="highlighter_318594_clipboard" type="application/x-shockwave-flash" title="复制到剪贴板" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_318594" menu="false" src="http://shiyanjun.cn/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/scripts/clipboard.swf"></div><a href="http://shiyanjun.cn/archives/1536.html#printSource" title="打印" class="item printSource" style="width: 16px; height: 16px;">打印</a><a href="http://shiyanjun.cn/archives/1536.html#about" title="帮助" class="item about" style="width: 16px; height: 16px;">帮助</a></div></div><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>01</code></td><td class="content"><code class="keyword">private</code><code class="plain">[spark] </code><code class="keyword">trait</code> <code class="plain">RpcEndpoint {</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>02</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>03</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">val</code> <code class="plain">rpcEnv</code><code class="keyword">:</code> <code class="plain">RpcEnv</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>04</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>05</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">final</code> <code class="keyword">def</code> <code class="plain">self</code><code class="keyword">:</code> <code class="plain">RpcEndpointRef </code><code class="keyword">=</code> <code class="plain">{</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>06</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">require(rpcEnv !</code><code class="keyword">=</code> <code class="keyword">null</code><code class="plain">, </code><code class="string">"rpcEnv has not been initialized"</code><code class="plain">)</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>07</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">rpcEnv.endpointRef(</code><code class="keyword">this</code><code class="plain">)</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>08</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>09</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>10</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">def</code> <code class="plain">receive</code><code class="keyword">:</code> <code class="plain">PartialFunction[Any, Unit] </code><code class="keyword">=</code> <code class="plain">{</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>11</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">case</code> <code class="keyword">_</code> <code class="keyword">=</code><code class="plain">&gt; </code><code class="keyword">throw</code> <code class="keyword">new</code> <code class="plain">SparkException(self + </code><code class="string">" does not implement 'receive'"</code><code class="plain">)</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>12</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>13</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>14</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">def</code> <code class="plain">receiveAndReply(context</code><code class="keyword">:</code> <code class="plain">RpcCallContext)</code><code class="keyword">:</code> <code class="plain">PartialFunction[Any, Unit] </code><code class="keyword">=</code> <code class="plain">{</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>15</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">case</code> <code class="keyword">_</code> <code class="keyword">=</code><code class="plain">&gt; context.sendFailure(</code><code class="keyword">new</code> <code class="plain">SparkException(self + </code><code class="string">" won't reply anything"</code><code class="plain">))</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>16</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>17</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>18</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">def</code> <code class="plain">onError(cause</code><code class="keyword">:</code> <code class="plain">Throwable)</code><code class="keyword">:</code> <code class="plain">Unit </code><code class="keyword">=</code> <code class="plain">{</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>19</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="comments">// By default, throw e and let RpcEnv handle it</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>20</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">throw</code> <code class="plain">cause</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>21</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>22</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>23</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">def</code> <code class="plain">onConnected(remoteAddress</code><code class="keyword">:</code> <code class="plain">RpcAddress)</code><code class="keyword">:</code> <code class="plain">Unit </code><code class="keyword">=</code> <code class="plain">{</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>24</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="comments">// By default, do nothing.</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>25</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>26</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>27</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">def</code> <code class="plain">onDisconnected(remoteAddress</code><code class="keyword">:</code> <code class="plain">RpcAddress)</code><code class="keyword">:</code> <code class="plain">Unit </code><code class="keyword">=</code> <code class="plain">{</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>28</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="comments">// By default, do nothing.</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>29</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>30</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>31</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">def</code> <code class="plain">onNetworkError(cause</code><code class="keyword">:</code> <code class="plain">Throwable, remoteAddress</code><code class="keyword">:</code> <code class="plain">RpcAddress)</code><code class="keyword">:</code> <code class="plain">Unit </code><code class="keyword">=</code> <code class="plain">{</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>32</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="comments">// By default, do nothing.</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>33</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>34</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>35</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">def</code> <code class="plain">onStart()</code><code class="keyword">:</code> <code class="plain">Unit </code><code class="keyword">=</code> <code class="plain">{</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>36</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="comments">// By default, do nothing.</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>37</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>38</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>39</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">def</code> <code class="plain">onStop()</code><code class="keyword">:</code> <code class="plain">Unit </code><code class="keyword">=</code> <code class="plain">{</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>40</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="comments">// By default, do nothing.</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>41</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>42</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>43</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">final</code> <code class="keyword">def</code> <code class="plain">stop()</code><code class="keyword">:</code> <code class="plain">Unit </code><code class="keyword">=</code> <code class="plain">{</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>44</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">val</code> <code class="keyword">_</code><code class="plain">self </code><code class="keyword">=</code> <code class="plain">self</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>45</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">if</code> <code class="plain">(</code><code class="keyword">_</code><code class="plain">self !</code><code class="keyword">=</code> <code class="keyword">null</code><code class="plain">) {</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>46</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">rpcEnv.stop(</code><code class="keyword">_</code><code class="plain">self)</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>47</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>48</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>49</code></td><td class="content"><code class="plain">}</code></td></tr></tbody></table></div></div></div>
<p>通过上面的receive方法，接收由RpcEndpointRef.send方法发送的消息，该类消息不需要进行响应消息（Reply），而只是在RpcEndpoint端进行处理。通过receiveAndReply方法，接收由RpcEndpointRef.ask发送的消息，RpcEndpoint端处理完消息后，需要给调用RpcEndpointRef.ask的通信端响应消息（Reply）。</p>
<ul>
<li>RpcEndpointRef</li>
</ul>
<p>RpcEndpointRef是一个对RpcEndpoint的远程引用对象，通过它可以向远程的RpcEndpoint端发送消息以进行通信。RpcEndpointRef特质的定义，代码如下所示：</p>
<div id="highlighter_458677" class="syntaxhighlighter  "><div class="bar"><div class="toolbar"><a href="http://shiyanjun.cn/archives/1536.html#viewSource" title="查看源代码" class="item viewSource" style="width: 16px; height: 16px;">查看源代码</a><div class="item copyToClipboard"><embed width="16" height="16" id="highlighter_458677_clipboard" type="application/x-shockwave-flash" title="复制到剪贴板" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_458677" menu="false" src="http://shiyanjun.cn/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/scripts/clipboard.swf"></div><a href="http://shiyanjun.cn/archives/1536.html#printSource" title="打印" class="item printSource" style="width: 16px; height: 16px;">打印</a><a href="http://shiyanjun.cn/archives/1536.html#about" title="帮助" class="item about" style="width: 16px; height: 16px;">帮助</a></div></div><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>01</code></td><td class="content"><code class="keyword">private</code><code class="plain">[spark] </code><code class="keyword">abstract</code> <code class="keyword">class</code> <code class="plain">RpcEndpointRef(conf</code><code class="keyword">:</code> <code class="plain">SparkConf)&nbsp; </code><code class="keyword">extends</code> <code class="plain">Serializable </code><code class="keyword">with</code> <code class="plain">Logging { </code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>02</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>03</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">private</code><code class="plain">[</code><code class="keyword">this</code><code class="plain">] </code><code class="keyword">val</code> <code class="plain">maxRetries </code><code class="keyword">=</code> <code class="plain">RpcUtils.numRetries(conf)</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>04</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">private</code><code class="plain">[</code><code class="keyword">this</code><code class="plain">] </code><code class="keyword">val</code> <code class="plain">retryWaitMs </code><code class="keyword">=</code> <code class="plain">RpcUtils.retryWaitMs(conf)</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>05</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">private</code><code class="plain">[</code><code class="keyword">this</code><code class="plain">] </code><code class="keyword">val</code> <code class="plain">defaultAskTimeout </code><code class="keyword">=</code> <code class="plain">RpcUtils.askRpcTimeout(conf)</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>06</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>07</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">def</code> <code class="plain">address</code><code class="keyword">:</code> <code class="plain">RpcAddress</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>08</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>09</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">def</code> <code class="plain">name</code><code class="keyword">:</code> <code class="plain">String</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>10</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>11</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">def</code> <code class="plain">send(message</code><code class="keyword">:</code> <code class="plain">Any)</code><code class="keyword">:</code> <code class="plain">Unit</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>12</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>13</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">def</code> <code class="plain">ask[T</code><code class="keyword">:</code> <code class="plain">ClassTag](message</code><code class="keyword">:</code> <code class="plain">Any, timeout</code><code class="keyword">:</code> <code class="plain">RpcTimeout)</code><code class="keyword">:</code> <code class="plain">Future[T]</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>14</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>15</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">def</code> <code class="plain">ask[T</code><code class="keyword">:</code> <code class="plain">ClassTag](message</code><code class="keyword">:</code> <code class="plain">Any)</code><code class="keyword">:</code> <code class="plain">Future[T] </code><code class="keyword">=</code> <code class="plain">ask(message, defaultAskTimeout)</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>16</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>17</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">def</code> <code class="plain">askWithRetry[T</code><code class="keyword">:</code> <code class="plain">ClassTag](message</code><code class="keyword">:</code> <code class="plain">Any)</code><code class="keyword">:</code> <code class="plain">T </code><code class="keyword">=</code> <code class="plain">askWithRetry(message, defaultAskTimeout)</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>18</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>19</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">def</code> <code class="plain">askWithRetry[T</code><code class="keyword">:</code> <code class="plain">ClassTag](message</code><code class="keyword">:</code> <code class="plain">Any, timeout</code><code class="keyword">:</code> <code class="plain">RpcTimeout)</code><code class="keyword">:</code> <code class="plain">T </code><code class="keyword">=</code> <code class="plain">{</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>20</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">... ...</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>21</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>22</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>23</code></td><td class="content"><code class="plain">}</code></td></tr></tbody></table></div></div></div>
<p>上面代码中，send方法发送消息后不等待响应，亦即Send-and-forget，Spark中基于Netty实现，实现在NettyRpcEndpointRef中，如下所示：</p>
<div id="highlighter_773937" class="syntaxhighlighter  "><div class="bar"><div class="toolbar"><a href="http://shiyanjun.cn/archives/1536.html#viewSource" title="查看源代码" class="item viewSource" style="width: 16px; height: 16px;">查看源代码</a><div class="item copyToClipboard"><embed width="16" height="16" id="highlighter_773937_clipboard" type="application/x-shockwave-flash" title="复制到剪贴板" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_773937" menu="false" src="http://shiyanjun.cn/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/scripts/clipboard.swf"></div><a href="http://shiyanjun.cn/archives/1536.html#printSource" title="打印" class="item printSource" style="width: 16px; height: 16px;">打印</a><a href="http://shiyanjun.cn/archives/1536.html#about" title="帮助" class="item about" style="width: 16px; height: 16px;">帮助</a></div></div><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>1</code></td><td class="content"><code class="keyword">override</code> <code class="keyword">def</code> <code class="plain">send(message</code><code class="keyword">:</code> <code class="plain">Any)</code><code class="keyword">:</code> <code class="plain">Unit </code><code class="keyword">=</code> <code class="plain">{</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>2</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">require(message !</code><code class="keyword">=</code> <code class="keyword">null</code><code class="plain">, </code><code class="string">"Message is null"</code><code class="plain">)</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>3</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">nettyEnv.send(RequestMessage(nettyEnv.address, </code><code class="keyword">this</code><code class="plain">, message))</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>4</code></td><td class="content"><code class="plain">}</code></td></tr></tbody></table></div></div></div>
<p>可见，它是通过NettyRpcEnv来发送RequestMessage消息，并将当前NettyRpcEndpointRef封装到RequestMessage消息对象中发送出去，通信对端通过该NettyRpcEndpointRef能够识别出消息来源。<br>
而ask方法发送消息后需要等待通信对端给予响应，通过Future来异步获取响应结果，也是在NettyRpcEndpointRef中实现，如下所示：</p>
<div id="highlighter_236464" class="syntaxhighlighter  "><div class="bar"><div class="toolbar"><a href="http://shiyanjun.cn/archives/1536.html#viewSource" title="查看源代码" class="item viewSource" style="width: 16px; height: 16px;">查看源代码</a><div class="item copyToClipboard"><embed width="16" height="16" id="highlighter_236464_clipboard" type="application/x-shockwave-flash" title="复制到剪贴板" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_236464" menu="false" src="http://shiyanjun.cn/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/scripts/clipboard.swf"></div><a href="http://shiyanjun.cn/archives/1536.html#printSource" title="打印" class="item printSource" style="width: 16px; height: 16px;">打印</a><a href="http://shiyanjun.cn/archives/1536.html#about" title="帮助" class="item about" style="width: 16px; height: 16px;">帮助</a></div></div><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>1</code></td><td class="content"><code class="keyword">override</code> <code class="keyword">def</code> <code class="plain">ask[T</code><code class="keyword">:</code> <code class="plain">ClassTag](message</code><code class="keyword">:</code> <code class="plain">Any, timeout</code><code class="keyword">:</code> <code class="plain">RpcTimeout)</code><code class="keyword">:</code> <code class="plain">Future[T] </code><code class="keyword">=</code> <code class="plain">{</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>2</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">nettyEnv.ask(RequestMessage(nettyEnv.address, </code><code class="keyword">this</code><code class="plain">, message), timeout)</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>3</code></td><td class="content"><code class="plain">}</code></td></tr></tbody></table></div></div></div>
<p>类似的，也是通过NettyRpcEnv来发送一个RequestMessage消息。</p>
<ul>
<li>RpcEnv</li>
</ul>
<p>一个RpcEnv是一个RPC环境对象，它负责管理RpcEndpoint的注册，以及如何从一个RpcEndpoint获取到一个RpcEndpointRef。RpcEndpoint是一个通信端，例如Spark集群中的Master，或Worker，都是一个RpcEndpoint。但是，如果想要与一个RpcEndpoint端进行通信，一定需要获取到该RpcEndpoint一个RpcEndpointRef，而获取该RpcEndpointRef只能通过一个RpcEnv环境对象来获取。所以说，一个RpcEnv对象才是RPC通信过程中的“指挥官”，在RpcEnv类中，有一个核心的方法：<br>
  def setupEndpoint(name: String, endpoint: RpcEndpoint): RpcEndpointRef<br>
通过上面方法，可以注册一个RpcEndpoint到RpcEnv环境对象中，有RpcEnv来管理RpcEndpoint到RpcEndpointRef的绑定关系。在注册RpcEndpoint时，每个RpcEndpoint都需要有一个唯一的名称。<br>
Spark中基于Netty实现通信，所以对应的RpcEnv实现为NettyRpcEnv，上面方法的实现，如下所示：</p>
<div id="highlighter_69549" class="syntaxhighlighter  "><div class="bar"><div class="toolbar"><a href="http://shiyanjun.cn/archives/1536.html#viewSource" title="查看源代码" class="item viewSource" style="width: 16px; height: 16px;">查看源代码</a><div class="item copyToClipboard"><embed width="16" height="16" id="highlighter_69549_clipboard" type="application/x-shockwave-flash" title="复制到剪贴板" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_69549" menu="false" src="http://shiyanjun.cn/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/scripts/clipboard.swf"></div><a href="http://shiyanjun.cn/archives/1536.html#printSource" title="打印" class="item printSource" style="width: 16px; height: 16px;">打印</a><a href="http://shiyanjun.cn/archives/1536.html#about" title="帮助" class="item about" style="width: 16px; height: 16px;">帮助</a></div></div><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>1</code></td><td class="content"><code class="keyword">override</code> <code class="keyword">def</code> <code class="plain">setupEndpoint(name</code><code class="keyword">:</code> <code class="plain">String, endpoint</code><code class="keyword">:</code> <code class="plain">RpcEndpoint)</code><code class="keyword">:</code> <code class="plain">RpcEndpointRef </code><code class="keyword">=</code> <code class="plain">{</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>2</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">dispatcher.registerRpcEndpoint(name, endpoint)</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>3</code></td><td class="content"><code class="plain">}</code></td></tr></tbody></table></div></div></div>
<p>调用NettyRpcEnv内部的Dispatcher对象注册一个RpcEndpoint：</p>
<div id="highlighter_261007" class="syntaxhighlighter  "><div class="bar"><div class="toolbar"><a href="http://shiyanjun.cn/archives/1536.html#viewSource" title="查看源代码" class="item viewSource" style="width: 16px; height: 16px;">查看源代码</a><div class="item copyToClipboard"><embed width="16" height="16" id="highlighter_261007_clipboard" type="application/x-shockwave-flash" title="复制到剪贴板" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_261007" menu="false" src="http://shiyanjun.cn/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/scripts/clipboard.swf"></div><a href="http://shiyanjun.cn/archives/1536.html#printSource" title="打印" class="item printSource" style="width: 16px; height: 16px;">打印</a><a href="http://shiyanjun.cn/archives/1536.html#about" title="帮助" class="item about" style="width: 16px; height: 16px;">帮助</a></div></div><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>01</code></td><td class="content"><code class="keyword">def</code> <code class="plain">registerRpcEndpoint(name</code><code class="keyword">:</code> <code class="plain">String, endpoint</code><code class="keyword">:</code> <code class="plain">RpcEndpoint)</code><code class="keyword">:</code> <code class="plain">NettyRpcEndpointRef </code><code class="keyword">=</code> <code class="plain">{</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>02</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">val</code> <code class="plain">addr </code><code class="keyword">=</code> <code class="plain">RpcEndpointAddress(nettyEnv.address, name)</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>03</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">val</code> <code class="plain">endpointRef </code><code class="keyword">=</code> <code class="keyword">new</code> <code class="plain">NettyRpcEndpointRef(nettyEnv.conf, addr, nettyEnv)</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>04</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">synchronized {</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>05</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">if</code> <code class="plain">(stopped) {</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>06</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">throw</code> <code class="keyword">new</code> <code class="plain">IllegalStateException(</code><code class="string">"RpcEnv has been stopped"</code><code class="plain">)</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>07</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>08</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">if</code> <code class="plain">(endpoints.putIfAbsent(name, </code><code class="keyword">new</code> <code class="plain">EndpointData(name, endpoint, endpointRef)) !</code><code class="keyword">=</code> <code class="keyword">null</code><code class="plain">) {</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>09</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">throw</code> <code class="keyword">new</code> <code class="plain">IllegalArgumentException(s</code><code class="string">"There is already an RpcEndpoint called $name"</code><code class="plain">)</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>10</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>11</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">val</code> <code class="plain">data </code><code class="keyword">=</code> <code class="plain">endpoints.get(name)</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>12</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">endpointRefs.put(data.endpoint, data.ref)</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>13</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">receivers.offer(data)&nbsp; </code><code class="comments">// for the OnStart message</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>14</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>15</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">endpointRef</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>16</code></td><td class="content"><code class="plain">}</code></td></tr></tbody></table></div></div></div>
<p>一个RpcEndpoint只能注册一次（根据RpcEndpoint的名称来检查唯一性），这样在Dispatcher内部注册并维护RpcEndpoint与RpcEndpointRef的绑定关系，通过如下两个内部结构：</p>
<div id="highlighter_601865" class="syntaxhighlighter  "><div class="bar"><div class="toolbar"><a href="http://shiyanjun.cn/archives/1536.html#viewSource" title="查看源代码" class="item viewSource" style="width: 16px; height: 16px;">查看源代码</a><div class="item copyToClipboard"><embed width="16" height="16" id="highlighter_601865_clipboard" type="application/x-shockwave-flash" title="复制到剪贴板" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_601865" menu="false" src="http://shiyanjun.cn/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/scripts/clipboard.swf"></div><a href="http://shiyanjun.cn/archives/1536.html#printSource" title="打印" class="item printSource" style="width: 16px; height: 16px;">打印</a><a href="http://shiyanjun.cn/archives/1536.html#about" title="帮助" class="item about" style="width: 16px; height: 16px;">帮助</a></div></div><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>1</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">private</code> <code class="keyword">val</code> <code class="plain">endpoints </code><code class="keyword">=</code> <code class="keyword">new</code> <code class="plain">ConcurrentHashMap[String, EndpointData]</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>2</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">private</code> <code class="keyword">val</code> <code class="plain">endpointRefs </code><code class="keyword">=</code> <code class="keyword">new</code> <code class="plain">ConcurrentHashMap[RpcEndpoint, RpcEndpointRef]</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>3</code></td><td class="content"><code class="plain">可以看到，一个命名唯一的RpcEndpoint在Dispatcher中对应一个EndpointData来维护其信息，该数据结构定义，如下所示：</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>4</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">private</code> <code class="keyword">class</code> <code class="plain">EndpointData(</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>5</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">val</code> <code class="plain">name</code><code class="keyword">:</code> <code class="plain">String,</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>6</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">val</code> <code class="plain">endpoint</code><code class="keyword">:</code> <code class="plain">RpcEndpoint,</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>7</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">val</code> <code class="plain">ref</code><code class="keyword">:</code> <code class="plain">NettyRpcEndpointRef) {</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>8</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">val</code> <code class="plain">inbox </code><code class="keyword">=</code> <code class="keyword">new</code> <code class="plain">Inbox(ref, endpoint)</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>9</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div></div></div>
<p>这里，每一个命名唯一的RpcEndpoint对应一个线程安全的Inbox，所有发送给一个RpcEndpoint的消息，都由对应的Inbox将对应的消息路由给RpcEndpoint进行处理，后面我们会详细分析Inbox。</p>
<p><strong style="font-size: 20px">创建NettyRpcEnv环境对象</strong></p>
<p>创建NettyRpcEnv对象，是一个非常重的操作，所以在框架里使用过程中要尽量避免重复创建。创建NettyRpcEnv，会创建很多用来处理底层RPC通信的线程和数据结构。具体的创建过程，如下图所示：<br>
<a href="./简单之美 _ Spark RPC通信层设计原理分析_files/SparkRPC-Create-NettyRpcEnv.png"><img src="./简单之美 _ Spark RPC通信层设计原理分析_files/SparkRPC-Create-NettyRpcEnv.png" alt="SparkRPC-Create-NettyRpcEnv" width="1024" height="749" class="alignnone size-full wp-image-1538"></a><br>
具体要点，描述如下：</p>
<ul>
<li>创建一个NettyRpcEnv对象对象，需要通过NettyRpcEnvFactory来创建</li>
<li>Dispatcher负责RPC消息的路由，它能够将消息路由到对应的RpcEndpoint进行处理</li>
<li>NettyStreamManager负责提供文件服务（文件、JAR文件、目录）</li>
<li>NettyRpcHandler负责处理网络IO事件，接收RPC调用请求，并通过Dispatcher派发消息</li>
<li>TransportContext负责管理网路传输上下文信息：创建MessageEncoder、MessageDecoder、TransportClientFactory、TransportServer</li>
<li>TransportServer配置并启动一个RPC Server服务</li>
</ul>
<p><strong style="font-size: 20px">消息路由过程分析</strong></p>
<p>基于Standalone模式，Spark集群具有Master和一组Worker，Worker与Master之间需要进行通信，我们以此为例，来说明基于Spark PRC层是如何实现消息的路由的。<br>
首先看Master端实现，代码如下所示：</p>
<div id="highlighter_595829" class="syntaxhighlighter  "><div class="bar"><div class="toolbar"><a href="http://shiyanjun.cn/archives/1536.html#viewSource" title="查看源代码" class="item viewSource" style="width: 16px; height: 16px;">查看源代码</a><div class="item copyToClipboard"><embed width="16" height="16" id="highlighter_595829_clipboard" type="application/x-shockwave-flash" title="复制到剪贴板" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_595829" menu="false" src="http://shiyanjun.cn/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/scripts/clipboard.swf"></div><a href="http://shiyanjun.cn/archives/1536.html#printSource" title="打印" class="item printSource" style="width: 16px; height: 16px;">打印</a><a href="http://shiyanjun.cn/archives/1536.html#about" title="帮助" class="item about" style="width: 16px; height: 16px;">帮助</a></div></div><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>01</code></td><td class="content"><code class="keyword">def</code> <code class="plain">startRpcEnvAndEndpoint(</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>02</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">host</code><code class="keyword">:</code> <code class="plain">String,</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>03</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">port</code><code class="keyword">:</code> <code class="plain">Int,</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>04</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">webUiPort</code><code class="keyword">:</code> <code class="plain">Int,</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>05</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">conf</code><code class="keyword">:</code> <code class="plain">SparkConf)</code><code class="keyword">:</code> <code class="plain">(RpcEnv, Int, Option[Int]) </code><code class="keyword">=</code> <code class="plain">{</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>06</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">val</code> <code class="plain">securityMgr </code><code class="keyword">=</code> <code class="keyword">new</code> <code class="plain">SecurityManager(conf)</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>07</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">val</code> <code class="plain">rpcEnv </code><code class="keyword">=</code> <code class="plain">RpcEnv.create(SYSTEM</code><code class="keyword">_</code><code class="plain">NAME, host, port, conf, securityMgr)</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>08</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">val</code> <code class="plain">masterEndpoint </code><code class="keyword">=</code> <code class="plain">rpcEnv.setupEndpoint(ENDPOINT</code><code class="keyword">_</code><code class="plain">NAME,</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>09</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">new</code> <code class="plain">Master(rpcEnv, rpcEnv.address, webUiPort, securityMgr, conf))</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>10</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">val</code> <code class="plain">portsResponse </code><code class="keyword">=</code> <code class="plain">masterEndpoint.askWithRetry[BoundPortsResponse](BoundPortsRequest)</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>11</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">(rpcEnv, portsResponse.webUIPort, portsResponse.restPort)</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>12</code></td><td class="content"><code class="plain">}</code></td></tr></tbody></table></div></div></div>
<p>上面代码中，创建一个RpcEnv对象，通过创建一个NettyRpcEnvFactory对象来完成该RpcEnv对象的创建，实际创建了一个NettyRpcEnv对象。接着，通过setupEndpoint方法注册一个RpcEndpoint，这里Master就是一个RpcEndpoint，返回的masterEndpoint是Master的RpcEndpointRef引用对象。下面，我们看一下，发送一个BoundPortsRequest消息，具体的消息路由过程，如下图所示：<br>
<a href="./简单之美 _ Spark RPC通信层设计原理分析_files/Master.png"><img src="./简单之美 _ Spark RPC通信层设计原理分析_files/Master.png" alt="Master" width="1024" height="727" class="alignnone size-full wp-image-1539"></a><br>
上图中显示本地消息和远程消息派发的流程，最主要的区别是在接收消息时：接收消息走的是Inbox，发送消息走的是Outbox。</p>
<p><strong style="font-size: 20px">本地消息路由</strong></p>
<p>发送一个BoundPortsRequest消息，实际走的是本地消息路由，直接放到对应的Inbox中，对应的代码处理逻辑如下所示：</p>
<div id="highlighter_135436" class="syntaxhighlighter  "><div class="bar"><div class="toolbar"><a href="http://shiyanjun.cn/archives/1536.html#viewSource" title="查看源代码" class="item viewSource" style="width: 16px; height: 16px;">查看源代码</a><div class="item copyToClipboard"><embed width="16" height="16" id="highlighter_135436_clipboard" type="application/x-shockwave-flash" title="复制到剪贴板" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_135436" menu="false" src="http://shiyanjun.cn/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/scripts/clipboard.swf"></div><a href="http://shiyanjun.cn/archives/1536.html#printSource" title="打印" class="item printSource" style="width: 16px; height: 16px;">打印</a><a href="http://shiyanjun.cn/archives/1536.html#about" title="帮助" class="item about" style="width: 16px; height: 16px;">帮助</a></div></div><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>01</code></td><td class="content"><code class="keyword">private</code> <code class="keyword">def</code> <code class="plain">postMessage(</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>02</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">endpointName</code><code class="keyword">:</code> <code class="plain">String,</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>03</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">message</code><code class="keyword">:</code> <code class="plain">InboxMessage,</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>04</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">callbackIfStopped</code><code class="keyword">:</code> <code class="plain">(Exception) </code><code class="keyword">=</code><code class="plain">&gt; Unit)</code><code class="keyword">:</code> <code class="plain">Unit </code><code class="keyword">=</code> <code class="plain">{</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>05</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">val</code> <code class="plain">error </code><code class="keyword">=</code> <code class="plain">synchronized {</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>06</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">val</code> <code class="plain">data </code><code class="keyword">=</code> <code class="plain">endpoints.get(endpointName)</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>07</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">if</code> <code class="plain">(stopped) {</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>08</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">Some(</code><code class="keyword">new</code> <code class="plain">RpcEnvStoppedException())</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>09</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">} </code><code class="keyword">else</code> <code class="keyword">if</code> <code class="plain">(data </code><code class="keyword">==</code> <code class="keyword">null</code><code class="plain">) {</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>10</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">Some(</code><code class="keyword">new</code> <code class="plain">SparkException(s</code><code class="string">"Could not find $endpointName."</code><code class="plain">))</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>11</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">} </code><code class="keyword">else</code> <code class="plain">{</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>12</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">data.inbox.post(message)</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>13</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">receivers.offer(data)</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>14</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">None</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>15</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>16</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>17</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="comments">// We don't need to call `onStop` in the `synchronized` block</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>18</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">error.foreach(callbackIfStopped)</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>19</code></td><td class="content"><code class="plain">}</code></td></tr></tbody></table></div></div></div>
<p>上面通过data.inbox派发消息，然后将消息data :EndpointData放入到receivers队列，触发Dispatcher内部的MessageLoop线程去消费，如下所示：</p>
<div id="highlighter_427072" class="syntaxhighlighter  "><div class="bar"><div class="toolbar"><a href="http://shiyanjun.cn/archives/1536.html#viewSource" title="查看源代码" class="item viewSource" style="width: 16px; height: 16px;">查看源代码</a><div class="item copyToClipboard"><embed width="16" height="16" id="highlighter_427072_clipboard" type="application/x-shockwave-flash" title="复制到剪贴板" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_427072" menu="false" src="http://shiyanjun.cn/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/scripts/clipboard.swf"></div><a href="http://shiyanjun.cn/archives/1536.html#printSource" title="打印" class="item printSource" style="width: 16px; height: 16px;">打印</a><a href="http://shiyanjun.cn/archives/1536.html#about" title="帮助" class="item about" style="width: 16px; height: 16px;">帮助</a></div></div><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>01</code></td><td class="content"><code class="keyword">private</code> <code class="keyword">class</code> <code class="plain">MessageLoop </code><code class="keyword">extends</code> <code class="plain">Runnable {</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>02</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">override</code> <code class="keyword">def</code> <code class="plain">run()</code><code class="keyword">:</code> <code class="plain">Unit </code><code class="keyword">=</code> <code class="plain">{</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>03</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">try</code> <code class="plain">{</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>04</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">while</code> <code class="plain">(</code><code class="keyword">true</code><code class="plain">) {</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>05</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">try</code> <code class="plain">{</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>06</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">val</code> <code class="plain">data </code><code class="keyword">=</code> <code class="plain">receivers.take()</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>07</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">if</code> <code class="plain">(data </code><code class="keyword">==</code> <code class="plain">PoisonPill) {</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>08</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="comments">// Put PoisonPill back so that other MessageLoops can see it.</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>09</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">receivers.offer(PoisonPill)</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>10</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">return</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>11</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>12</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">data.inbox.process(Dispatcher.</code><code class="keyword">this</code><code class="plain">)</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>13</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">} </code><code class="keyword">catch</code> <code class="plain">{</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>14</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">case</code> <code class="plain">NonFatal(e) </code><code class="keyword">=</code><code class="plain">&gt; logError(e.getMessage, e)</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>15</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>16</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>17</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">} </code><code class="keyword">catch</code> <code class="plain">{</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>18</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">case</code> <code class="plain">ie</code><code class="keyword">:</code> <code class="plain">InterruptedException </code><code class="keyword">=</code><code class="plain">&gt; </code><code class="comments">// exit</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>19</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>20</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>21</code></td><td class="content"><code class="plain">}</code></td></tr></tbody></table></div></div></div>
<p>这里，又继续调用Inbox的process方法来派发消息到指定的RpcEndpoint。通过上面的序列图，我们可以通过源码分析看到，原始消息被层层封装为一个RpcMessage ，该消息在Inbox的process方法中处理派发逻辑，如下所示：</p>
<div id="highlighter_428951" class="syntaxhighlighter  "><div class="bar"><div class="toolbar"><a href="http://shiyanjun.cn/archives/1536.html#viewSource" title="查看源代码" class="item viewSource" style="width: 16px; height: 16px;">查看源代码</a><div class="item copyToClipboard"><embed width="16" height="16" id="highlighter_428951_clipboard" type="application/x-shockwave-flash" title="复制到剪贴板" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_428951" menu="false" src="http://shiyanjun.cn/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/scripts/clipboard.swf"></div><a href="http://shiyanjun.cn/archives/1536.html#printSource" title="打印" class="item printSource" style="width: 16px; height: 16px;">打印</a><a href="http://shiyanjun.cn/archives/1536.html#about" title="帮助" class="item about" style="width: 16px; height: 16px;">帮助</a></div></div><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>01</code></td><td class="content"><code class="keyword">case</code> <code class="plain">RpcMessage(</code><code class="keyword">_</code><code class="plain">sender, content, context) </code><code class="keyword">=</code><code class="plain">&gt;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>02</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">try</code> <code class="plain">{</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>03</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">endpoint.receiveAndReply(context).applyOrElse[Any, Unit](content, { msg </code><code class="keyword">=</code><code class="plain">&gt;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>04</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">throw</code> <code class="keyword">new</code> <code class="plain">SparkException(s</code><code class="string">"Unsupported message $message from ${_sender}"</code><code class="plain">)</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>05</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">})</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>06</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">} </code><code class="keyword">catch</code> <code class="plain">{</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>07</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">case</code> <code class="plain">NonFatal(e) </code><code class="keyword">=</code><code class="plain">&gt;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>08</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">context.sendFailure(e)</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>09</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="comments">// Throw the exception -- this exception will be caught by the safelyCall function.</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>10</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="comments">// The endpoint's onError function will be called.</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>11</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">throw</code> <code class="plain">e</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>12</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div></div></div>
<p>到这里，消息已经发送给对应的RpcEndpoint的receiveAndReply方法，我们这里实际上是Master实现类，这里的消息解包后为content: BoundPortsRequest，接下来应该看Master的receiveAndReply方法如何处理该本地消息，代码如下所示：</p>
<div id="highlighter_76600" class="syntaxhighlighter  "><div class="bar"><div class="toolbar"><a href="http://shiyanjun.cn/archives/1536.html#viewSource" title="查看源代码" class="item viewSource" style="width: 16px; height: 16px;">查看源代码</a><div class="item copyToClipboard"><embed width="16" height="16" id="highlighter_76600_clipboard" type="application/x-shockwave-flash" title="复制到剪贴板" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_76600" menu="false" src="http://shiyanjun.cn/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/scripts/clipboard.swf"></div><a href="http://shiyanjun.cn/archives/1536.html#printSource" title="打印" class="item printSource" style="width: 16px; height: 16px;">打印</a><a href="http://shiyanjun.cn/archives/1536.html#about" title="帮助" class="item about" style="width: 16px; height: 16px;">帮助</a></div></div><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>1</code></td><td class="content"><code class="keyword">case</code> <code class="plain">BoundPortsRequest </code><code class="keyword">=</code><code class="plain">&gt;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>2</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">context.reply(BoundPortsResponse(address.port, webUi.boundPort, restServerBoundPort))</code></td></tr></tbody></table></div></div></div>
<p>可以看出，实际上上面的处理逻辑没有什么处理，只是通过BoundPortsResponse返回了几个Master端的几个端口号数据。</p>
<p><strong style="font-size: 20px">远程消息路由</strong></p>
<p>我们都知道，Worker启动时，会向Master注册，通过该场景我们分析一下远程消息路由的过程。<br>
先看一下Worker端向Master注册过程，如下图所示：<br>
<a href="./简单之美 _ Spark RPC通信层设计原理分析_files/Worker.ask_.png"><img src="./简单之美 _ Spark RPC通信层设计原理分析_files/Worker.ask_.png" alt="Worker.ask" width="1024" height="318" class="alignnone size-full wp-image-1540"></a><br>
Worker启动时，会首先获取到一个Master的RpcEndpointRef远程引用，通过该引用对象能够与Master进行RPC通信，经过上面消息派发，最终通过Netty的Channel将消息发送到远程Master端。<br>
通过前面说明，我们知道Worker向Master注册的消息RegisterWorker应该最终会被路由到Master对应的Inbox中，然后派发给Master进行处理。下面，我们看一下Master端接收并处理消息的过程，如下图所示：<br>
<a href="./简单之美 _ Spark RPC通信层设计原理分析_files/Master.receiveAndReply.png"><img src="./简单之美 _ Spark RPC通信层设计原理分析_files/Master.receiveAndReply.png" alt="Master.receiveAndReply" width="1024" height="500" class="alignnone size-full wp-image-1541"></a><br>
上图分为两部分：一部分是从远端接收消息RegisterWorker，将接收到的消息放入到Inbox中；另一部分是触发MessageLoop线程处理该消息，进而通过调用Inbox的process方法，继续调用RpcEndpoint（Master）的receiveAndReply方法，处理消息RegisterWorker，如下所示：</p>
<div id="highlighter_644589" class="syntaxhighlighter  "><div class="bar"><div class="toolbar"><a href="http://shiyanjun.cn/archives/1536.html#viewSource" title="查看源代码" class="item viewSource" style="width: 16px; height: 16px;">查看源代码</a><div class="item copyToClipboard"><embed width="16" height="16" id="highlighter_644589_clipboard" type="application/x-shockwave-flash" title="复制到剪贴板" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_644589" menu="false" src="http://shiyanjun.cn/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/scripts/clipboard.swf"></div><a href="http://shiyanjun.cn/archives/1536.html#printSource" title="打印" class="item printSource" style="width: 16px; height: 16px;">打印</a><a href="http://shiyanjun.cn/archives/1536.html#about" title="帮助" class="item about" style="width: 16px; height: 16px;">帮助</a></div></div><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>01</code></td><td class="content"><code class="keyword">case</code> <code class="plain">RegisterWorker(</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>02</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">id, workerHost, workerPort, workerRef, cores, memory, workerWebUiUrl) </code><code class="keyword">=</code><code class="plain">&gt;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>03</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">logInfo(</code><code class="string">"Registering worker %s:%d with %d cores, %s RAM"</code><code class="plain">.format(</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>04</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">workerHost, workerPort, cores, Utils.megabytesToString(memory)))</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>05</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">if</code> <code class="plain">(state </code><code class="keyword">==</code> <code class="plain">RecoveryState.STANDBY) {</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>06</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">context.reply(MasterInStandby)</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>07</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">} </code><code class="keyword">else</code> <code class="keyword">if</code> <code class="plain">(idToWorker.contains(id)) {</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>08</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">context.reply(RegisterWorkerFailed(</code><code class="string">"Duplicate worker ID"</code><code class="plain">))</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>09</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">} </code><code class="keyword">else</code> <code class="plain">{</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>10</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">val</code> <code class="plain">worker </code><code class="keyword">=</code> <code class="keyword">new</code> <code class="plain">WorkerInfo(id, workerHost, workerPort, cores, memory,</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>11</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">workerRef, workerWebUiUrl)</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>12</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">if</code> <code class="plain">(registerWorker(worker)) {</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>13</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">persistenceEngine.addWorker(worker)</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>14</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">context.reply(RegisteredWorker(self, masterWebUiUrl))</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>15</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">schedule()</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>16</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">} </code><code class="keyword">else</code> <code class="plain">{</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>17</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">val</code> <code class="plain">workerAddress </code><code class="keyword">=</code> <code class="plain">worker.endpoint.address</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>18</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">logWarning(</code><code class="string">"Worker registration failed. Attempted to re-register worker at same "</code> <code class="plain">+</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>19</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="string">"address: "</code> <code class="plain">+ workerAddress)</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>20</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">context.reply(RegisterWorkerFailed(</code><code class="string">"Attempted to re-register worker at same address: "</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>21</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">+ workerAddress))</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>22</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>23</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div></div></div>
<p>如果Worker注册成功，则Master会通过context对象回复Worker响应：</p>
<div id="highlighter_979486" class="syntaxhighlighter  "><div class="bar"><div class="toolbar"><a href="http://shiyanjun.cn/archives/1536.html#viewSource" title="查看源代码" class="item viewSource" style="width: 16px; height: 16px;">查看源代码</a><div class="item copyToClipboard"><embed width="16" height="16" id="highlighter_979486_clipboard" type="application/x-shockwave-flash" title="复制到剪贴板" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_979486" menu="false" src="http://shiyanjun.cn/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/scripts/clipboard.swf"></div><a href="http://shiyanjun.cn/archives/1536.html#printSource" title="打印" class="item printSource" style="width: 16px; height: 16px;">打印</a><a href="http://shiyanjun.cn/archives/1536.html#about" title="帮助" class="item about" style="width: 16px; height: 16px;">帮助</a></div></div><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>1</code></td><td class="content"><code class="plain">context.reply(RegisteredWorker(self, masterWebUiUrl))</code></td></tr></tbody></table></div></div></div>
<p>这样，如果一切正常，则Worker会收到RegisteredWorker响应消息，从而获取到Master的RpcEndpointRef引用对象，能够通过该引用对象与Master交互。</p>
            <!-- 署名及许可协议 -->
            <div id="i_signature" style="display: block;background-color: #f8f8ee; border: solid 1px #e8e7d0; padding: 5px 10px 0px 10px; min-height: 10px; margin-bottom: 20px; margin-top: 20px; color: #666666;"><a target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/4.0" rel="license"><img align="left" src="./简单之美 _ Spark RPC通信层设计原理分析_files/88x31.png" style="border-width: 0pt;" alt="Creative Commons License"></a><p>本文基于<a target="_blank" title="Attribution-NonCommercial 4.0 Unported" href="http://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">署名-非商业性使用-相同方式共享 4.0</a>许可协议发布，欢迎转载、使用、重新发布，但务必保留文章署名<a href="http://shiyanjun.cn/" target="_blank">时延军</a>（包含链接：http://shiyanjun.cn），不得用于商业目的，基于本文修改后的作品务必以相同的许可发布。如有任何疑问，请与我<a href="mailto:i@shiyanjun.cn" target="_blank">联系</a>。</p>
		            </div>
	</div><!-- .entry-content -->

	<footer class="entry-meta">
		
	</footer><!-- .entry-meta -->
</article><!-- #post-1536 -->

					<nav id="nav-below">
		<h1 class="assistive-text section-heading">Post navigation</h1>

	
		<div class="nav-previous" title="上一篇"><a href="http://shiyanjun.cn/archives/1508.html" rel="prev"><span class="meta-nav">←</span> Apache Flink：特性、概念、组件栈、架构及原理分析</a></div>		<div class="nav-next" title="下一篇"><a href="http://shiyanjun.cn/archives/1545.html" rel="next">Spark Standalone架构设计要点分析 <span class="meta-nav">→</span></a></div>
	
	</nav><!-- #nav-below -->
	
					<div id="comments">
	
	
			<h2 id="comments-title">
			评论(2)： “<span>Spark RPC通信层设计原理分析</span>”		</h2>


		<ol class="commentlist">
				<li class="comment even thread-even depth-1" id="li-comment-58661">
		<article id="comment-58661" class="comment">
			<footer class="clearfix comment-head">
				<div class="comment-author vcard">
					<img src="./简单之美 _ Spark RPC通信层设计原理分析_files/User.png" width="40" height="40" alt="" class="avatar avatar-40 wp-user-avatar wp-user-avatar-40 alignnone photo avatar-default">					<cite class="fn">无念</cite>				</div><!-- .comment-author .vcard -->
				
				<div class="comment-meta commentmetadata">
					<a href="http://shiyanjun.cn/archives/1536.html#comment-58661"><time pubdate="" datetime="2017-05-27T11:25:21+00:00">
					2017-05-27 11:25:21					</time></a>
									</div><!-- .comment-meta .commentmetadata -->
			</footer>

			<div class="comment-content"><p>网站的图好像都挂了，博主能重新补上嘛</p>
</div>

			<div class="reply">
				<a class="comment-reply-link" href="http://shiyanjun.cn/archives/1536.html?replytocom=58661#respond" onclick="return addComment.moveForm(&quot;comment-58661&quot;, &quot;58661&quot;, &quot;respond&quot;, &quot;1536&quot;)">回复</a>			</div><!-- .reply -->
		</article><!-- #comment-## -->

	</li><!-- #comment-## -->
	<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-58793">
		<article id="comment-58793" class="comment">
			<footer class="clearfix comment-head">
				<div class="comment-author vcard">
					<img src="./简单之美 _ Spark RPC通信层设计原理分析_files/User.png" width="40" height="40" alt="" class="avatar avatar-40 wp-user-avatar wp-user-avatar-40 alignnone photo avatar-default">					<cite class="fn">daxin</cite>				</div><!-- .comment-author .vcard -->
				
				<div class="comment-meta commentmetadata">
					<a href="http://shiyanjun.cn/archives/1536.html#comment-58793"><time pubdate="" datetime="2017-06-23T11:32:40+00:00">
					2017-06-23 11:32:40					</time></a>
									</div><!-- .comment-meta .commentmetadata -->
			</footer>

			<div class="comment-content"><p>之前有很多困惑看了博主博文有很多收获，还有一个困惑是：每一个机器节点都有各自的RpvEnv啊？(比如Worker 1 有自己的Rpcenv，worker2也有自己的Rpcenv)而不是所有的EndPoint共享一个RpcEnv！希望博主给一下答疑，谢谢</p>
</div>

			<div class="reply">
				<a class="comment-reply-link" href="http://shiyanjun.cn/archives/1536.html?replytocom=58793#respond" onclick="return addComment.moveForm(&quot;comment-58793&quot;, &quot;58793&quot;, &quot;respond&quot;, &quot;1536&quot;)">回复</a>			</div><!-- .reply -->
		</article><!-- #comment-## -->

	</li><!-- #comment-## -->
		</ol>

		
	
	
									<div id="respond" class="comment-respond">
				<h3 id="reply-title" class="comment-reply-title">发表评论 <small><a rel="nofollow" id="cancel-comment-reply-link" href="http://shiyanjun.cn/archives/1536.html#respond" style="display:none;">取消回复</a></small></h3>
									<form action="http://shiyanjun.cn/wp-comments-post.php" method="post" id="commentform" class="comment-form">
																			<p class="comment-notes">电子邮件地址不会被公开。 必填项已用<span class="required">*</span>标注</p>							<p class="comment-form-author"><label for="author">姓名 <span class="required">*</span></label> <input id="author" name="author" type="text" value="" size="30" aria-required="true"></p>
<p class="comment-form-email"><label for="email">电子邮件 <span class="required">*</span></label> <input id="email" name="email" type="text" value="" size="30" aria-required="true"></p>
<p class="comment-form-url"><label for="url">站点</label> <input id="url" name="url" type="text" value="" size="30"></p>
												<p class="comment-form-comment"><label for="comment">评论</label> <textarea id="comment" name="comment" cols="45" rows="8" aria-required="true"></textarea></p>						<p class="form-allowed-tags">您可以使用这些<abbr title="HyperText Markup Language">HTML</abbr>标签和属性： <code>&lt;a href="" title=""&gt; &lt;abbr title=""&gt; &lt;acronym title=""&gt; &lt;b&gt; &lt;blockquote cite=""&gt; &lt;cite&gt; &lt;code&gt; &lt;del datetime=""&gt; &lt;em&gt; &lt;i&gt; &lt;q cite=""&gt; &lt;strike&gt; &lt;strong&gt; </code></p>						<p class="form-submit">
							<input name="submit" type="submit" id="submit" value="发表评论">
							<input type="hidden" name="comment_post_ID" value="1536" id="comment_post_ID">
<input type="hidden" name="comment_parent" id="comment_parent" value="0">
						</p>
						<p style="display: none;"><input type="hidden" id="akismet_comment_nonce" name="akismet_comment_nonce" value="5eef961233"></p><p style="display: none;"></p>					<input type="hidden" id="ak_js" name="ak_js" value="1511573692125"></form>
							</div><!-- #respond -->
			
</div><!-- #comments -->
			
        </div> <!-- end #main -->

        		<div id="sidebar" class="widget-area col300" role="complementary">
					<div class="widget-wrap"><aside id="recent-posts-2" class="widget widget_recent_entries">		<h2 class="widget-title">最新文章</h2>		<ul>
					<li>
				<a href="http://shiyanjun.cn/archives/1738.html">基于YARN集群构建运行PySpark Application</a>
						</li>
					<li>
				<a href="http://shiyanjun.cn/archives/1728.html">CDH-5.7.0：基于Parcels方式离线安装配置</a>
						</li>
					<li>
				<a href="http://shiyanjun.cn/archives/1702.html">PB级海量数据服务平台架构设计实践</a>
						</li>
					<li>
				<a href="http://shiyanjun.cn/archives/1693.html">基于Spark ML Pipeline构建机器学习应用</a>
						</li>
					<li>
				<a href="http://shiyanjun.cn/archives/1671.html">Kubernetes基础篇：主要特性、基本概念与总体架构</a>
						</li>
					<li>
				<a href="http://shiyanjun.cn/archives/1655.html">Spark Shuffle过程分析：Map阶段处理流程</a>
						</li>
				</ul>
		</aside></div><div class="widget-wrap"><aside id="text-6" class="widget widget_text"><h2 class="widget-title">在线文档</h2>			<div class="textwidget">1. <a href="http://python3-cookbook.readthedocs.io/zh_CN/latest/" target="_blank">Python Cookbook 3rd</a><br>
2. <a href="https://jimmysong.io/kubernetes-handbook/" target="_blank">Kubernetes Handbook</a><br>
3. <a href="https://kaisery.github.io/trpl-zh-cn/" target="_blank">Rust程序设计</a>(<a href="https://doc.rust-lang.org/book/second-edition/">英文版</a>)<br>
4. <a href="http://wiki.jikexueyuan.com/project/tensorflow-zh/" target="_blank">TensorFlow官方文档中文版</a><br>
5. <a href="http://docs.scala-lang.org/" target="_blank">Scala官方文档</a><br>
6. <a href="https://github.com/josephmisiti/awesome-machine-learning" target="_blank">Awesome Machine Learning</a><br>
7. <a href="https://docs.hacknode.org/gopl-zh/" target="_blank">Go语言圣经中文版</a><br></div>
		</aside></div><div class="widget-wrap"><aside id="categories-2" class="widget widget_categories"><h2 class="widget-title">文章分类</h2>		<ul>
	<li class="cat-item cat-item-100"><a href="http://shiyanjun.cn/archives/category/container" title="查看容器技术下的所有文章">容器技术</a> (3)
<ul class="children">
	<li class="cat-item cat-item-104"><a href="http://shiyanjun.cn/archives/category/container/docker" title="查看Docker下的所有文章">Docker</a> (2)
</li>
	<li class="cat-item cat-item-105"><a href="http://shiyanjun.cn/archives/category/container/kubernetes" title="查看Kubernetes下的所有文章">Kubernetes</a> (1)
</li>
	<li class="cat-item cat-item-101"><a href="http://shiyanjun.cn/archives/category/container/swarm" title="查看Swarm下的所有文章">Swarm</a> (1)
</li>
</ul>
</li>
	<li class="cat-item cat-item-8"><a href="http://shiyanjun.cn/archives/category/opensource" title="查看开源技术下的所有文章">开源技术</a> (93)
<ul class="children">
	<li class="cat-item cat-item-86"><a href="http://shiyanjun.cn/archives/category/opensource/akka" title="查看Akka下的所有文章">Akka</a> (3)
</li>
	<li class="cat-item cat-item-97"><a href="http://shiyanjun.cn/archives/category/opensource/beam" title="查看Beam下的所有文章">Beam</a> (1)
</li>
	<li class="cat-item cat-item-84"><a href="http://shiyanjun.cn/archives/category/opensource/crunch" title="查看Crunch下的所有文章">Crunch</a> (1)
</li>
	<li class="cat-item cat-item-36"><a href="http://shiyanjun.cn/archives/category/opensource/dubbo" title="查看Dubbo下的所有文章">Dubbo</a> (4)
</li>
	<li class="cat-item cat-item-88"><a href="http://shiyanjun.cn/archives/category/opensource/elasticsearch" title="查看ElasticSearch下的所有文章">ElasticSearch</a> (1)
</li>
	<li class="cat-item cat-item-95"><a href="http://shiyanjun.cn/archives/category/opensource/flink" title="查看Flink下的所有文章">Flink</a> (1)
</li>
	<li class="cat-item cat-item-79"><a href="http://shiyanjun.cn/archives/category/opensource/flume" title="查看Flume下的所有文章">Flume</a> (2)
</li>
	<li class="cat-item cat-item-9"><a href="http://shiyanjun.cn/archives/category/opensource/hadoop" title="查看Hadoop下的所有文章">Hadoop</a> (24)
</li>
	<li class="cat-item cat-item-62"><a href="http://shiyanjun.cn/archives/category/opensource/hive" title="查看Hive下的所有文章">Hive</a> (2)
</li>
	<li class="cat-item cat-item-82"><a href="http://shiyanjun.cn/archives/category/opensource/hue" title="查看Hue下的所有文章">Hue</a> (1)
</li>
	<li class="cat-item cat-item-61"><a href="http://shiyanjun.cn/archives/category/opensource/impala" title="查看Impala下的所有文章">Impala</a> (2)
</li>
	<li class="cat-item cat-item-93"><a href="http://shiyanjun.cn/archives/category/opensource/mahout" title="查看Mahout下的所有文章">Mahout</a> (1)
</li>
	<li class="cat-item cat-item-29"><a href="http://shiyanjun.cn/archives/category/opensource/maven" title="查看Maven下的所有文章">Maven</a> (1)
</li>
	<li class="cat-item cat-item-30"><a href="http://shiyanjun.cn/archives/category/opensource/mina" title="查看Mina下的所有文章">Mina</a> (6)
</li>
	<li class="cat-item cat-item-73"><a href="http://shiyanjun.cn/archives/category/opensource/mybatis" title="查看Mybatis下的所有文章">Mybatis</a> (1)
</li>
	<li class="cat-item cat-item-15"><a href="http://shiyanjun.cn/archives/category/opensource/oozie" title="查看Oozie下的所有文章">Oozie</a> (4)
</li>
	<li class="cat-item cat-item-85"><a href="http://shiyanjun.cn/archives/category/opensource/pig" title="查看Pig下的所有文章">Pig</a> (1)
</li>
	<li class="cat-item cat-item-11"><a href="http://shiyanjun.cn/archives/category/opensource/solr" title="查看Solr下的所有文章">Solr</a> (5)
</li>
	<li class="cat-item cat-item-68"><a href="http://shiyanjun.cn/archives/category/opensource/spark" title="查看Spark下的所有文章">Spark</a> (13)
</li>
	<li class="cat-item cat-item-46"><a href="http://shiyanjun.cn/archives/category/opensource/spring" title="查看Spring下的所有文章">Spring</a> (1)
</li>
	<li class="cat-item cat-item-67"><a href="http://shiyanjun.cn/archives/category/opensource/sqoop" title="查看Sqoop下的所有文章">Sqoop</a> (3)
</li>
	<li class="cat-item cat-item-35"><a href="http://shiyanjun.cn/archives/category/opensource/storm" title="查看Storm下的所有文章">Storm</a> (5)
</li>
	<li class="cat-item cat-item-22"><a href="http://shiyanjun.cn/archives/category/opensource/thrift" title="查看Thrift下的所有文章">Thrift</a> (2)
</li>
	<li class="cat-item cat-item-38"><a href="http://shiyanjun.cn/archives/category/opensource/webservices" title="查看Web Services下的所有文章">Web Services</a> (1)
</li>
	<li class="cat-item cat-item-23"><a href="http://shiyanjun.cn/archives/category/opensource/zookeeper" title="查看ZooKeeper下的所有文章">ZooKeeper</a> (3)
</li>
</ul>
</li>
	<li class="cat-item cat-item-18"><a href="http://shiyanjun.cn/archives/category/database" title="查看数据库下的所有文章">数据库</a> (5)
<ul class="children">
	<li class="cat-item cat-item-20"><a href="http://shiyanjun.cn/archives/category/database/nosql" title="查看NoSQL数据库下的所有文章">NoSQL数据库</a> (4)
	<ul class="children">
	<li class="cat-item cat-item-10"><a href="http://shiyanjun.cn/archives/category/database/nosql/hbase" title="查看HBase下的所有文章">HBase</a> (3)
</li>
	<li class="cat-item cat-item-21"><a href="http://shiyanjun.cn/archives/category/database/nosql/redis" title="查看Redis下的所有文章">Redis</a> (1)
</li>
	</ul>
</li>
	<li class="cat-item cat-item-19"><a href="http://shiyanjun.cn/archives/category/database/rdb" title="查看关系数据库下的所有文章">关系数据库</a> (1)
	<ul class="children">
	<li class="cat-item cat-item-49"><a href="http://shiyanjun.cn/archives/category/database/rdb/mysql" title="查看MySQL下的所有文章">MySQL</a> (1)
</li>
	</ul>
</li>
</ul>
</li>
	<li class="cat-item cat-item-16"><a href="http://shiyanjun.cn/archives/category/server" title="查看服务器下的所有文章">服务器</a> (4)
<ul class="children">
	<li class="cat-item cat-item-78"><a href="http://shiyanjun.cn/archives/category/server/ganglia" title="查看Ganglia下的所有文章">Ganglia</a> (1)
</li>
	<li class="cat-item cat-item-37"><a href="http://shiyanjun.cn/archives/category/server/haproxy" title="查看HAProxy下的所有文章">HAProxy</a> (1)
</li>
	<li class="cat-item cat-item-76"><a href="http://shiyanjun.cn/archives/category/server/memcached" title="查看Memcached下的所有文章">Memcached</a> (1)
</li>
	<li class="cat-item cat-item-17"><a href="http://shiyanjun.cn/archives/category/server/nginx" title="查看Nginx下的所有文章">Nginx</a> (1)
</li>
</ul>
</li>
	<li class="cat-item cat-item-12"><a href="http://shiyanjun.cn/archives/category/machinelearning" title="查看机器学习下的所有文章">机器学习</a> (12)
</li>
	<li class="cat-item cat-item-43"><a href="http://shiyanjun.cn/archives/category/architecture" title="查看架构下的所有文章">架构</a> (1)
</li>
	<li class="cat-item cat-item-70"><a href="http://shiyanjun.cn/archives/category/algorithm" title="查看算法下的所有文章">算法</a> (8)
</li>
	<li class="cat-item cat-item-2"><a href="http://shiyanjun.cn/archives/category/programming" title="查看编程语言下的所有文章">编程语言</a> (4)
<ul class="children">
	<li class="cat-item cat-item-3"><a href="http://shiyanjun.cn/archives/category/programming/java" title="查看Java下的所有文章">Java</a> (2)
</li>
	<li class="cat-item cat-item-74"><a href="http://shiyanjun.cn/archives/category/programming/nodejs" title="查看Node.js下的所有文章">Node.js</a> (1)
</li>
	<li class="cat-item cat-item-5"><a href="http://shiyanjun.cn/archives/category/programming/php" title="查看PHP下的所有文章">PHP</a> (1)
</li>
</ul>
</li>
		</ul>
</aside></div><div class="widget-wrap"><aside id="archives-2" class="widget widget_archive"><h2 class="widget-title">文章存档</h2>		<ul>
	<li><a href="http://shiyanjun.cn/archives/date/2017/10">2017年十月</a>&nbsp;(1)</li>
	<li><a href="http://shiyanjun.cn/archives/date/2017/09">2017年九月</a>&nbsp;(1)</li>
	<li><a href="http://shiyanjun.cn/archives/date/2017/08">2017年八月</a>&nbsp;(1)</li>
	<li><a href="http://shiyanjun.cn/archives/date/2017/07">2017年七月</a>&nbsp;(1)</li>
	<li><a href="http://shiyanjun.cn/archives/date/2017/06">2017年六月</a>&nbsp;(1)</li>
	<li><a href="http://shiyanjun.cn/archives/date/2017/05">2017年五月</a>&nbsp;(1)</li>
	<li><a href="http://shiyanjun.cn/archives/date/2017/04">2017年四月</a>&nbsp;(1)</li>
	<li><a href="http://shiyanjun.cn/archives/date/2017/03">2017年三月</a>&nbsp;(3)</li>
	<li><a href="http://shiyanjun.cn/archives/date/2017/02">2017年二月</a>&nbsp;(1)</li>
	<li><a href="http://shiyanjun.cn/archives/date/2017/01">2017年一月</a>&nbsp;(1)</li>
	<li><a href="http://shiyanjun.cn/archives/date/2016/11">2016年十一月</a>&nbsp;(1)</li>
	<li><a href="http://shiyanjun.cn/archives/date/2016/09">2016年九月</a>&nbsp;(1)</li>
	<li><a href="http://shiyanjun.cn/archives/date/2016/04">2016年四月</a>&nbsp;(1)</li>
	<li><a href="http://shiyanjun.cn/archives/date/2016/02">2016年二月</a>&nbsp;(3)</li>
	<li><a href="http://shiyanjun.cn/archives/date/2015/12">2015年十二月</a>&nbsp;(5)</li>
	<li><a href="http://shiyanjun.cn/archives/date/2015/11">2015年十一月</a>&nbsp;(4)</li>
	<li><a href="http://shiyanjun.cn/archives/date/2015/10">2015年十月</a>&nbsp;(2)</li>
	<li><a href="http://shiyanjun.cn/archives/date/2015/09">2015年九月</a>&nbsp;(1)</li>
	<li><a href="http://shiyanjun.cn/archives/date/2015/08">2015年八月</a>&nbsp;(3)</li>
	<li><a href="http://shiyanjun.cn/archives/date/2015/07">2015年七月</a>&nbsp;(1)</li>
	<li><a href="http://shiyanjun.cn/archives/date/2015/06">2015年六月</a>&nbsp;(1)</li>
	<li><a href="http://shiyanjun.cn/archives/date/2015/05">2015年五月</a>&nbsp;(1)</li>
	<li><a href="http://shiyanjun.cn/archives/date/2015/04">2015年四月</a>&nbsp;(1)</li>
	<li><a href="http://shiyanjun.cn/archives/date/2015/03">2015年三月</a>&nbsp;(1)</li>
	<li><a href="http://shiyanjun.cn/archives/date/2015/02">2015年二月</a>&nbsp;(1)</li>
	<li><a href="http://shiyanjun.cn/archives/date/2015/01">2015年一月</a>&nbsp;(1)</li>
	<li><a href="http://shiyanjun.cn/archives/date/2014/12">2014年十二月</a>&nbsp;(2)</li>
	<li><a href="http://shiyanjun.cn/archives/date/2014/11">2014年十一月</a>&nbsp;(1)</li>
	<li><a href="http://shiyanjun.cn/archives/date/2014/10">2014年十月</a>&nbsp;(3)</li>
	<li><a href="http://shiyanjun.cn/archives/date/2014/09">2014年九月</a>&nbsp;(1)</li>
	<li><a href="http://shiyanjun.cn/archives/date/2014/08">2014年八月</a>&nbsp;(1)</li>
	<li><a href="http://shiyanjun.cn/archives/date/2014/07">2014年七月</a>&nbsp;(2)</li>
	<li><a href="http://shiyanjun.cn/archives/date/2014/06">2014年六月</a>&nbsp;(2)</li>
	<li><a href="http://shiyanjun.cn/archives/date/2014/05">2014年五月</a>&nbsp;(2)</li>
	<li><a href="http://shiyanjun.cn/archives/date/2014/04">2014年四月</a>&nbsp;(1)</li>
	<li><a href="http://shiyanjun.cn/archives/date/2014/03">2014年三月</a>&nbsp;(14)</li>
	<li><a href="http://shiyanjun.cn/archives/date/2014/02">2014年二月</a>&nbsp;(4)</li>
	<li><a href="http://shiyanjun.cn/archives/date/2014/01">2014年一月</a>&nbsp;(1)</li>
	<li><a href="http://shiyanjun.cn/archives/date/2013/12">2013年十二月</a>&nbsp;(3)</li>
	<li><a href="http://shiyanjun.cn/archives/date/2013/11">2013年十一月</a>&nbsp;(5)</li>
	<li><a href="http://shiyanjun.cn/archives/date/2013/10">2013年十月</a>&nbsp;(6)</li>
	<li><a href="http://shiyanjun.cn/archives/date/2013/09">2013年九月</a>&nbsp;(13)</li>
	<li><a href="http://shiyanjun.cn/archives/date/2013/08">2013年八月</a>&nbsp;(21)</li>
		</ul>
</aside></div><div class="widget-wrap"><aside id="colorful_tag_cloud-2" class="widget widget_colorful_tag_cloud"><h2 class="widget-title">全站标签</h2><a href="http://shiyanjun.cn/archives/tag/hwi" class="tag-link-77" title="1" style="font-size: 12pt; color: #00a650">HWI</a>
<a href="http://shiyanjun.cn/archives/tag/solrcloud" class="tag-link-27" title="1" style="font-size: 12pt; color: #00a650">SolrCloud</a>
<a href="http://shiyanjun.cn/archives/tag/kubernetes" class="tag-link-105" title="1" style="font-size: 12pt; color: #00a650">Kubernetes</a>
<a href="http://shiyanjun.cn/archives/tag/swarm" class="tag-link-101" title="1" style="font-size: 12pt; color: #00a650">Swarm</a>
<a href="http://shiyanjun.cn/archives/tag/hadoop-1-2-1" class="tag-link-80" title="11" style="font-size: 23.7983193277pt; color: #8fc63d">Hadoop-1.2.1</a>
<a href="http://shiyanjun.cn/archives/tag/jstorm" class="tag-link-83" title="1" style="font-size: 12pt; color: #00a650">JStorm</a>
<a href="http://shiyanjun.cn/archives/tag/hessian" class="tag-link-41" title="1" style="font-size: 12pt; color: #00a650">Hessian</a>
<a href="http://shiyanjun.cn/archives/tag/redis" class="tag-link-21" title="1" style="font-size: 12pt; color: #00a650">Redis</a>
<a href="http://shiyanjun.cn/archives/tag/jvm" class="tag-link-42" title="1" style="font-size: 12pt; color: #00a650">JVM</a>
<a href="http://shiyanjun.cn/archives/tag/jregex" class="tag-link-26" title="1" style="font-size: 12pt; color: #00a650">JRegex</a>
<a href="http://shiyanjun.cn/archives/tag/spring" class="tag-link-46" title="1" style="font-size: 12pt; color: #00a650">Spring</a>
<a href="http://shiyanjun.cn/archives/tag/k-means" class="tag-link-64" title="2" style="font-size: 14.7226890756pt; color: #f16522">K-means</a>
<a href="http://shiyanjun.cn/archives/tag/mapreduce" class="tag-link-34" title="13" style="font-size: 24.8571428571pt; color: #005b7e">MapReduce</a>
<a href="http://shiyanjun.cn/archives/tag/hbase" class="tag-link-10" title="4" style="font-size: 18.0504201681pt; color: #0f0">HBase</a>
<a href="http://shiyanjun.cn/archives/tag/node-js" class="tag-link-75" title="1" style="font-size: 12pt; color: #00a650">Node.js</a>
<a href="http://shiyanjun.cn/archives/tag/thrift" class="tag-link-22" title="4" style="font-size: 18.0504201681pt; color: #0f0">Thrift</a>
<a href="http://shiyanjun.cn/archives/tag/solr" class="tag-link-11" title="5" style="font-size: 19.2605042017pt; color: #2f3192">Solr</a>
<a href="http://shiyanjun.cn/archives/tag/java" class="tag-link-3" title="2" style="font-size: 14.7226890756pt; color: #f16522">Java</a>
<a href="http://shiyanjun.cn/archives/tag/elasticsearch" class="tag-link-88" title="1" style="font-size: 12pt; color: #00a650">ElasticSearch</a>
<a href="http://shiyanjun.cn/archives/tag/mahout" class="tag-link-93" title="1" style="font-size: 12pt; color: #00a650">Mahout</a>
<a href="http://shiyanjun.cn/archives/tag/memcached" class="tag-link-76" title="1" style="font-size: 12pt; color: #00a650">Memcached</a>
<a href="http://shiyanjun.cn/archives/tag/zookeeper" class="tag-link-23" title="4" style="font-size: 18.0504201681pt; color: #0f0">ZooKeeper</a>
<a href="http://shiyanjun.cn/archives/tag/mina-2" class="tag-link-31" title="6" style="font-size: 20.3193277311pt; color: #00f">Mina</a>
<a href="http://shiyanjun.cn/archives/tag/crunch" class="tag-link-84" title="1" style="font-size: 12pt; color: #00a650">Crunch</a>
<a href="http://shiyanjun.cn/archives/tag/haproxy" class="tag-link-37" title="1" style="font-size: 12pt; color: #00a650">HAProxy</a>
<a href="http://shiyanjun.cn/archives/tag/sqoop" class="tag-link-67" title="3" style="font-size: 16.5378151261pt; color: #bc8cbf">Sqoop</a>
<a href="http://shiyanjun.cn/archives/tag/pig" class="tag-link-85" title="1" style="font-size: 12pt; color: #00a650">Pig</a>
<a href="http://shiyanjun.cn/archives/tag/dbscan" class="tag-link-87" title="1" style="font-size: 12pt; color: #00a650">DBSCAN</a>
<a href="http://shiyanjun.cn/archives/tag/libsvm" class="tag-link-32" title="2" style="font-size: 14.7226890756pt; color: #f16522">libsvm</a>
<a href="http://shiyanjun.cn/archives/tag/docker" class="tag-link-104" title="2" style="font-size: 14.7226890756pt; color: #f16522">Docker</a>
<a href="http://shiyanjun.cn/archives/tag/hue" class="tag-link-82" title="1" style="font-size: 12pt; color: #00a650">Hue</a>
<a href="http://shiyanjun.cn/archives/tag/cf" class="tag-link-92" title="1" style="font-size: 12pt; color: #00a650">CF</a>
<a href="http://shiyanjun.cn/archives/tag/c4-5" class="tag-link-60" title="1" style="font-size: 12pt; color: #00a650">C4.5</a>
<a href="http://shiyanjun.cn/archives/tag/id3" class="tag-link-57" title="1" style="font-size: 12pt; color: #00a650">ID3</a>
<a href="http://shiyanjun.cn/archives/tag/hdfs" class="tag-link-72" title="5" style="font-size: 19.2605042017pt; color: #2f3192">HDFS</a>
<a href="http://shiyanjun.cn/archives/tag/%e6%8e%92%e5%ba%8f" class="tag-link-71" title="8" style="font-size: 21.8319327731pt; color: #f0f">排序</a>
<a href="http://shiyanjun.cn/archives/tag/storm" class="tag-link-35" title="5" style="font-size: 19.2605042017pt; color: #2f3192">Storm</a>
<a href="http://shiyanjun.cn/archives/tag/k-medoids" class="tag-link-91" title="1" style="font-size: 12pt; color: #00a650">k-medoids</a>
<a href="http://shiyanjun.cn/archives/tag/yarn" class="tag-link-65" title="2" style="font-size: 14.7226890756pt; color: #f16522">YARN</a>
<a href="http://shiyanjun.cn/archives/tag/mysql" class="tag-link-49" title="1" style="font-size: 12pt; color: #00a650">MySQL</a>
<a href="http://shiyanjun.cn/archives/tag/spark" class="tag-link-68" title="13" style="font-size: 24.8571428571pt; color: #005b7e">Spark</a>
<a href="http://shiyanjun.cn/archives/tag/spark-2-0-0" class="tag-link-96" title="5" style="font-size: 19.2605042017pt; color: #2f3192">Spark-2.0.0</a>
<a href="http://shiyanjun.cn/archives/tag/beam" class="tag-link-97" title="1" style="font-size: 12pt; color: #00a650">Beam</a>
<a href="http://shiyanjun.cn/archives/tag/springcloud" class="tag-link-98" title="1" style="font-size: 12pt; color: #00a650">SpringCloud</a>
<a href="http://shiyanjun.cn/archives/tag/akka" class="tag-link-86" title="3" style="font-size: 16.5378151261pt; color: #bc8cbf">Akka</a>
<a href="http://shiyanjun.cn/archives/tag/impala" class="tag-link-61" title="2" style="font-size: 14.7226890756pt; color: #f16522">Impala</a>
<a href="http://shiyanjun.cn/archives/tag/kafka" class="tag-link-81" title="1" style="font-size: 12pt; color: #00a650">Kafka</a>
<a href="http://shiyanjun.cn/archives/tag/%e5%88%86%e7%b1%bb" class="tag-link-90" title="3" style="font-size: 16.5378151261pt; color: #bc8cbf">分类</a>
<a href="http://shiyanjun.cn/archives/tag/flink" class="tag-link-95" title="1" style="font-size: 12pt; color: #00a650">Flink</a>
<a href="http://shiyanjun.cn/archives/tag/oozie" class="tag-link-15" title="4" style="font-size: 18.0504201681pt; color: #0f0">Oozie</a>
<a href="http://shiyanjun.cn/archives/tag/tomcat" class="tag-link-28" title="1" style="font-size: 12pt; color: #00a650">Tomcat</a>
<a href="http://shiyanjun.cn/archives/tag/hive" class="tag-link-62" title="3" style="font-size: 16.5378151261pt; color: #bc8cbf">Hive</a>
<a href="http://shiyanjun.cn/archives/tag/mybatis" class="tag-link-73" title="1" style="font-size: 12pt; color: #00a650">Mybatis</a>
<a href="http://shiyanjun.cn/archives/tag/nginx" class="tag-link-17" title="1" style="font-size: 12pt; color: #00a650">Nginx</a>
<a href="http://shiyanjun.cn/archives/tag/jax-ws" class="tag-link-39" title="1" style="font-size: 12pt; color: #00a650">JAX-WS</a>
<a href="http://shiyanjun.cn/archives/tag/maven" class="tag-link-29" title="1" style="font-size: 12pt; color: #00a650">Maven</a>
<a href="http://shiyanjun.cn/archives/tag/ganglia" class="tag-link-78" title="1" style="font-size: 12pt; color: #00a650">Ganglia</a>
<a href="http://shiyanjun.cn/archives/tag/svm" class="tag-link-33" title="1" style="font-size: 12pt; color: #00a650">SVM</a>
<a href="http://shiyanjun.cn/archives/tag/hadoop2" class="tag-link-25" title="3" style="font-size: 16.5378151261pt; color: #bc8cbf">Hadoop2</a>
<a href="http://shiyanjun.cn/archives/tag/hadoop" class="tag-link-9" title="30" style="font-size: 30pt; color: #ee1d24">Hadoop</a>
<a href="http://shiyanjun.cn/archives/tag/%e5%86%b3%e7%ad%96%e6%a0%91" class="tag-link-58" title="2" style="font-size: 14.7226890756pt; color: #f16522">决策树</a>
<a href="http://shiyanjun.cn/archives/tag/%e8%81%9a%e7%b1%bb" class="tag-link-89" title="3" style="font-size: 16.5378151261pt; color: #bc8cbf">聚类</a>
<a href="http://shiyanjun.cn/archives/tag/pyspark" class="tag-link-107" title="1" style="font-size: 12pt; color: #00a650">PySpark</a>
<a href="http://shiyanjun.cn/archives/tag/flume" class="tag-link-79" title="2" style="font-size: 14.7226890756pt; color: #f16522">Flume</a>
<a href="http://shiyanjun.cn/archives/tag/cdh" class="tag-link-106" title="1" style="font-size: 12pt; color: #00a650">CDH</a>
<a href="http://shiyanjun.cn/archives/tag/dubbo" class="tag-link-36" title="4" style="font-size: 18.0504201681pt; color: #0f0">Dubbo</a>
<a href="http://shiyanjun.cn/archives/tag/sql" class="tag-link-24" title="1" style="font-size: 12pt; color: #00a650">SQL</a>
<a href="http://shiyanjun.cn/archives/tag/web-services" class="tag-link-40" title="1" style="font-size: 12pt; color: #00a650">Web Services</a>
<a href="http://shiyanjun.cn/archives/tag/eureka" class="tag-link-99" title="1" style="font-size: 12pt; color: #00a650">Eureka</a>
<a href="http://shiyanjun.cn/archives/tag/php" class="tag-link-5" title="1" style="font-size: 12pt; color: #00a650">PHP</a></aside></div><div class="widget-wrap"><aside id="get-recent-comments" class="widget widget_get_recent_comments"><h2 class="widget-title">最新评论</h2><div id="get_recent_comments_wrap"><ul>	<li><a href="http://shiyanjun.cn/archives/1288.html#comment-59430" title="DBSCAN聚类算法原理及其实现, 2015-11-14 22:51:18">dtcue</a>: 请问博主怎么看那四个图就能确定Eps的范围大致在0.002~ 0.006之间的？</li>
	<li><a href="http://shiyanjun.cn/archives/1497.html#comment-59392" title="Flume日志收集分层架构应用实践, 2016-02-26 14:49:13">remainsu</a>: 如果其他人看到了，知道是怎么回事，还请不吝赐教，我的邮箱：r emainsu@outlook.com</li>
	<li><a href="http://shiyanjun.cn/archives/1497.html#comment-59391" title="Flume日志收集分层架构应用实践, 2016-02-26 14:49:13">苏</a>: 楼主是否有遇到：使用lsof -p flume进程id，查看的时候会有很多：can’ t identify protocol...</li>
	<li><a href="http://shiyanjun.cn/archives/526.html#comment-59360" title="Impala与HBase整合实践, 2013-11-12 16:25:41">stars_dba</a>: 那个impala是否可以跟hive server共用一台机器？它需要的内存大吗？</li>
	<li><a href="http://shiyanjun.cn/archives/744.html#comment-59359" title="RDD：基于内存的集群计算容错抽象, 2014-03-13 21:39:32">yala</a>: 附上google能搜索到的论文的中文版： http://spark.apachecn.org/p...</li>
	<li><a href="http://shiyanjun.cn/archives/744.html#comment-59358" title="RDD：基于内存的集群计算容错抽象, 2014-03-13 21:39:32">yala</a>: 抱歉，我注意到了，lz标记了自己的论文出处。 这和现在google能搜索到的论文版本不一样，请lz注意。 我收回之前的话，抱歉。</li>
</ul></div></aside></div><div class="widget-wrap"><aside id="text-5" class="widget widget_text"><h2 class="widget-title">友情链接</h2>			<div class="textwidget">- <a href="https://kiswo.com/" target="_blank">One Rain's Blog</a><br>
- <a href="http://coolshell.cn/" target="_blank">酷壳网</a><br>
- <a href="http://rootsongjc.github.io/" target="_blank">Jimmy Song's Blog</a><br>
</div>
		</aside></div><div class="widget-wrap"><aside id="meta-2" class="widget widget_meta"><h2 class="widget-title">站点管理</h2>			<ul>
						<li><a href="http://shiyanjun.cn/wp-login.php">登录</a></li>
			<li><a href="http://shiyanjun.cn/feed" title="使用RSS 2.0订阅本站点内容">文章<abbr title="Really Simple Syndication">RSS</abbr></a></li>
			<li><a href="http://shiyanjun.cn/comments/feed" title="使用RSS订阅本站点的所有文章的近期评论">评论<abbr title="Really Simple Syndication">RSS</abbr></a></li>
<li><a href="https://cn.wordpress.org/" title="基于WordPress，一个优美、先进的个人信息发布平台。">WordPress.org</a></li>			</ul>
</aside></div><div class="widget-wrap"><aside id="text-4" class="widget widget_text"><h2 class="widget-title">  </h2>			<div class="textwidget"><p><script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_1000041007'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s22.cnzz.com/z_stat.php%3Fid%3D1000041007%26online%3D1%26show%3Dline' type='text/javascript'%3E%3C/script%3E"));</script><span id="cnzz_stat_icon_1000041007"><a href="http://www.cnzz.com/stat/website.php?web_id=1000041007" target="_blank">站长统计</a><a href="http://www.cnzz.com/stat/website.php?web_id=1000041007" target="_blank"> |  今日IP[136] | 今日PV[162] | 昨日IP[1882] |  昨日PV[2719] | </a><a href="http://www.cnzz.com/stat/website.php?web_id=1000041007&amp;method=online" target="_blank">当前在线[7]</a></span><script src="./简单之美 _ Spark RPC通信层设计原理分析_files/z_stat.php" type="text/javascript"></script><script src="./简单之美 _ Spark RPC通信层设计原理分析_files/core.php" charset="utf-8" type="text/javascript"></script><br>
<!--<br />
<a target="_blank" href="https://www.upyun.com/"><img src="http://upfiles.b0.upaiyun.com/logo/180x90.png" alt="UPYUN"></a><br />
--></p>
</div>
		</aside></div>		</div><!-- #secondary .widget-area -->

    </div> <!-- end #content -->
        
	<footer id="colophon" role="contentinfo">
		<div id="site-generator">
			COPYRIGHT © 2013-2018 <a href="http://www.shiyanjun.cn/" rel="designer"><strong>简单之美</strong></a>            <span class="sep"> | </span>
             Powered by <a href="http://wordpress.org/" title="Semantic Personal Publishing Platform">WORDPRESS</a>
<span class="sep"> | </span>
			 <a href="http://www.miitbeian.gov.cn/">京ICP备14038454号</a>
            		</div>
		<div id="partnership">
			<a target="_blank" href="https://www.upyun.com/"><img src="./简单之美 _ Spark RPC通信层设计原理分析_files/90X45.png" title="UPYUN"></a>
			<!-- <a target="_blank" href="https://www.upyun.com/"><img src="https://www.upyun.com/static/img/%E5%B8%B8%E7%94%A82.07990f9.png" title="UPYUN"></a> -->
		</div>
	</footer><!-- #colophon -->
</div><!-- #page -->

<div id="wp-auto-top"><div id="wp-auto-top-top"></div><div id="wp-auto-top-comment"></div><div id="wp-auto-top-bottom"></div></div>
<script> var commentPositionId = '#comments';var wpAutoTopSpeed = 5;</script><style>
   #wp-auto-top{position:fixed;top:85%;right:50%;display:block;margin-right:-49%; z-index:9999;}
   #wp-auto-top-top,#wp-auto-top-comment,#wp-auto-top-bottom{background:url(http://shiyanjun.cn/wp-content/plugins/wp-auto-top/img/29.png) no-repeat;position:relative;cursor:pointer;height:25px;width:29px;margin:10px 0 0;}
   #wp-auto-top-comment{background-position:left -30px;height:32px;}#wp-auto-top-bottom{background-position:left -68px;}
   #wp-auto-top-comment:hover{background-position:right -30px;}
   #wp-auto-top-top:hover{background-position:right 0;}
   #wp-auto-top-bottom:hover{background-position:right -68px ;}
   </style><script type="text/javascript" src="./简单之美 _ Spark RPC通信层设计原理分析_files/form.js.下载"></script>
<script type="text/javascript" src="./简单之美 _ Spark RPC通信层设计原理分析_files/shCore.js.下载"></script>
<script type="text/javascript" src="./简单之美 _ Spark RPC通信层设计原理分析_files/shBrushScala.js.下载"></script>
<script type="text/javascript">
	(function(){
		var corecss = document.createElement('link');
		var themecss = document.createElement('link');
		var corecssurl = "http://shiyanjun.cn/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/styles/shCore.css?ver=2.1.364";
		if ( corecss.setAttribute ) {
				corecss.setAttribute( "rel", "stylesheet" );
				corecss.setAttribute( "type", "text/css" );
				corecss.setAttribute( "href", corecssurl );
		} else {
				corecss.rel = "stylesheet";
				corecss.href = corecssurl;
		}
		document.getElementsByTagName("head")[0].insertBefore( corecss, document.getElementById("syntaxhighlighteranchor") );
		var themecssurl = "http://shiyanjun.cn/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/styles/shThemeDefault.css?ver=2.1.364";
		if ( themecss.setAttribute ) {
				themecss.setAttribute( "rel", "stylesheet" );
				themecss.setAttribute( "type", "text/css" );
				themecss.setAttribute( "href", themecssurl );
		} else {
				themecss.rel = "stylesheet";
				themecss.href = themecssurl;
		}
		//document.getElementById("syntaxhighlighteranchor").appendChild(themecss);
		document.getElementsByTagName("head")[0].insertBefore( themecss, document.getElementById("syntaxhighlighteranchor") );
	})();
	SyntaxHighlighter.config.clipboardSwf = 'http://shiyanjun.cn/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/scripts/clipboard.swf';
	SyntaxHighlighter.config.strings.expandSource = 'show source';
	SyntaxHighlighter.config.strings.viewSource = '查看源代码';
	SyntaxHighlighter.config.strings.copyToClipboard = '复制到剪贴板';
	SyntaxHighlighter.config.strings.copyToClipboardConfirmation = '代码现在在你的剪贴板';
	SyntaxHighlighter.config.strings.print = '打印';
	SyntaxHighlighter.config.strings.help = '帮助';
	SyntaxHighlighter.config.strings.alert = 'SyntaxHighlighter\n\n';
	SyntaxHighlighter.config.strings.noBrush = '无法找到Brush：';
	SyntaxHighlighter.config.strings.brushNotHtmlScript = 'Brush不能设置 html-script选项';
	SyntaxHighlighter.defaults['pad-line-numbers'] = 1;
	SyntaxHighlighter.all();
</script>
<script type="text/javascript" src="./简单之美 _ Spark RPC通信层设计原理分析_files/comment-reply.min.js.下载"></script>
<script type="text/javascript" src="./简单之美 _ Spark RPC通信层设计原理分析_files/wp-auto-top.js.下载"></script>


<div style="position: static; width: 0px; height: 0px; border: none; padding: 0px; margin: 0px;"><div id="trans-tooltip"><div id="tip-left-top" style="background: url(&quot;chrome-extension://ccfjcepmiaackkccabgeeegeklgifffd/imgs/map/tip-left-top.png&quot;);"></div><div id="tip-top" style="background: url(&quot;chrome-extension://ccfjcepmiaackkccabgeeegeklgifffd/imgs/map/tip-top.png&quot;) repeat-x;"></div><div id="tip-right-top" style="background: url(&quot;chrome-extension://ccfjcepmiaackkccabgeeegeklgifffd/imgs/map/tip-right-top.png&quot;);"></div><div id="tip-right" style="background: url(&quot;chrome-extension://ccfjcepmiaackkccabgeeegeklgifffd/imgs/map/tip-right.png&quot;) repeat-y;"></div><div id="tip-right-bottom" style="background: url(&quot;chrome-extension://ccfjcepmiaackkccabgeeegeklgifffd/imgs/map/tip-right-bottom.png&quot;);"></div><div id="tip-bottom" style="background: url(&quot;chrome-extension://ccfjcepmiaackkccabgeeegeklgifffd/imgs/map/tip-bottom.png&quot;) repeat-x;"></div><div id="tip-left-bottom" style="background: url(&quot;chrome-extension://ccfjcepmiaackkccabgeeegeklgifffd/imgs/map/tip-left-bottom.png&quot;);"></div><div id="tip-left" style="background: url(&quot;chrome-extension://ccfjcepmiaackkccabgeeegeklgifffd/imgs/map/tip-left.png&quot;);"></div><div id="trans-content"></div></div><div id="tip-arrow-bottom" style="background: url(&quot;chrome-extension://ccfjcepmiaackkccabgeeegeklgifffd/imgs/map/tip-arrow-bottom.png&quot;);"></div><div id="tip-arrow-top" style="background: url(&quot;chrome-extension://ccfjcepmiaackkccabgeeegeklgifffd/imgs/map/tip-arrow-top.png&quot;);"></div></div></body></html>